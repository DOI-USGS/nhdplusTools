<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3DHP Data Access • nhdplusTools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="3DHP Data Access">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nhdplusTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/nhdplusTools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/get_3dhp_data.html">3DHP Data Access</a>
    </li>
    <li>
      <a href="../articles/get_data_overview.html">NHDPlusTools Data Access Overview</a>
    </li>
    <li>
      <a href="../articles/indexing.html">Indexing and Referencing</a>
    </li>
    <li>
      <a href="../articles/nhdplushr.html">Working with NHDPlusHR</a>
    </li>
    <li>
      <a href="../articles/plot_nhdplus.html">Plotting with nhdplusTools</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/doi-usgs/nhdplusTools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>3DHP Data Access</h1>
                        <h4 data-toc-skip class="author"><a href="mailto:dblodgett@usgs.gov" class="email">dblodgett@usgs.gov</a></h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/doi-usgs/nhdplusTools/blob/HEAD/vignettes/get_3dhp_data.Rmd" class="external-link"><code>vignettes/get_3dhp_data.Rmd</code></a></small>
      <div class="hidden name"><code>get_3dhp_data.Rmd</code></div>

    </div>

    
    
<p>This vignette shows how to work with a <a href="https://hydro.nationalmap.gov/arcgis/rest/services/3DHP_all/MapServer" class="external-link">new
service based on data from the 3D Hydrography Program (3DHP)</a>
released in 2024. 3DHP data uses “mainstem” identifiers as the primary
river ID. We’ll work with one for the Baraboo River in Wisconsin.</p>
<p>We can find one to start with at a url like:</p>
<p><code>https://reference.geoconnex.us/collections/mainstems/items?filter=name_at_outlet ILIKE '%Baraboo%'</code></p>
<p>This url searches the reference mainstem collection for rivers with
names like “Baraboo”. Using that url query, we can find that the Baraboo
mainstem ID is <code>https://geoconnex.us/ref/mainstems/359842</code>
and that it flows to the Wisconsin and Mississippi
<code>https://geoconnex.us/ref/mainstems/323742</code> and
<code>https://geoconnex.us/ref/mainstems/312091</code> respectively. At
the reference mainstem page, we can also find that the outlet NHDPlusV2
COMID is
<code>https://geoconnex.us/nhdplusv2/comid/937070225</code>.</p>
<p>The code block just below generates starting locations based on
information derived from the reference mainstem for the Baraboo and a
point location near the Baraboo’s outlet. It queries the 3DHP service
for a flowline within a 10m buffer of the point specified just to get us
started.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span>  <span class="va">comid</span> <span class="op">&lt;-</span> <span class="st">"937070225"</span></span>
<span></span>
<span>  <span class="va">point</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">89.441</span>, <span class="fl">43.487</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">dm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'https://geoconnex.us/ref/mainstems/323742'</span>,</span>
<span>          <span class="st">'https://geoconnex.us/ref/mainstems/312091'</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">flowline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_3dhp.html">get_3dhp</a></span><span class="op">(</span><span class="va">point</span>, type <span class="op">=</span> <span class="st">"flowline"</span>, buffer <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">pc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">3857</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/plot_nhdplus.html">plot_nhdplus</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">flowline</span><span class="op">)</span>, plot_config <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>flowline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span>, zoom <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">pc</span><span class="op">(</span><span class="va">flowline</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"darkblue"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">pc</span><span class="op">(</span><span class="va">point</span><span class="op">)</span>, pch <span class="op">=</span> <span class="st">"O"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="get_3dhp_data_files/figure-html/unnamed-chunk-1-1.png" width="576"></p>
<p>Now, we can use <a href="https://cran.r-project.org/package=dataRetrieval" class="external-link">dataRetrieval</a>
to retrieve a basin upstream of this outlet location. We specify the
NHDPlusV2 comid here since we know it, but could have used the point
location just as well.</p>
<p>With the basin pulled from the <a href="https://doi-usgs.github.io/dataRetrieval/reference/findNLDI.html" class="external-link"><code>findNLDI()</code></a>
function, we can pass it to <code><a href="../reference/get_3dhp.html">get_3dhp()</a></code> as a Area of
Interest for flowlines, waterbodies, and hydrolocations. We can then use
the mainstem ids of our two downstream mainstem rivers found above to
get the downtream mainstem rivers.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">basin</span> <span class="op">&lt;-</span> <span class="fu">dataRetrieval</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/findNLDI.html" class="external-link">findNLDI</a></span><span class="op">(</span>comid <span class="op">=</span> <span class="va">comid</span>, find <span class="op">=</span> <span class="st">"basin"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">network</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_3dhp.html">get_3dhp</a></span><span class="op">(</span><span class="va">basin</span><span class="op">$</span><span class="va">basin</span>, type <span class="op">=</span> <span class="st">"flowline"</span><span class="op">)</span></span>
<span>  <span class="va">water</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_3dhp.html">get_3dhp</a></span><span class="op">(</span><span class="va">basin</span><span class="op">$</span><span class="va">basin</span>, type <span class="op">=</span> <span class="st">"waterbody"</span><span class="op">)</span></span>
<span>  <span class="va">hydrolocation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_3dhp.html">get_3dhp</a></span><span class="op">(</span><span class="va">basin</span><span class="op">$</span><span class="va">basin</span>, type <span class="op">=</span> <span class="st">"hydrolocation"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in (function (AOI = NULL, ids = NULL, type = NULL, service = NULL, :</span></span>
<span><span class="co">#&gt; sink, spring, waterbody outlet features found but were outside area of interest</span></span>
<span><span class="co">#&gt; polygon.</span></span>
<span><span class="co">#&gt; Warning: No sink, spring, waterbody outlet features found</span></span>
<span><span class="co">#&gt; Warning: No headwater, terminus, divergence, confluence, catchment outlet</span></span>
<span><span class="co">#&gt; features found in area of interest.</span></span>
<span>  </span>
<span>  <span class="va">down_mains</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_3dhp.html">get_3dhp</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="va">dm</span>, type <span class="op">=</span> <span class="st">"flowline"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">old_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/plot_nhdplus.html">plot_nhdplus</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">basin</span><span class="op">$</span><span class="va">basin</span><span class="op">)</span>, flowline_only <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>               plot_config <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>flowline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span>, zoom <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">pc</span><span class="op">(</span><span class="va">basin</span><span class="op">$</span><span class="va">basin</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">pc</span><span class="op">(</span><span class="va">network</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">0.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">pc</span><span class="op">(</span><span class="va">water</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">0.5</span>, border <span class="op">=</span> <span class="st">"skyblue"</span>, col <span class="op">=</span> <span class="st">"lightblue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">pc</span><span class="op">(</span><span class="va">hydrolocation</span><span class="op">)</span>, pch <span class="op">=</span> <span class="st">"o"</span>, col <span class="op">=</span> <span class="st">"#80808026"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">pc</span><span class="op">(</span><span class="va">down_mains</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">3</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="get_3dhp_data_files/figure-html/unnamed-chunk-2-1.png" width="576"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">old_par</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">old_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">pc</span><span class="op">(</span><span class="va">down_mains</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">pc</span><span class="op">(</span><span class="va">basin</span><span class="op">$</span><span class="va">basin</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="get_3dhp_data_files/figure-html/unnamed-chunk-2-2.png" width="576"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">old_par</span><span class="op">)</span></span></code></pre></div>
<p>Neat. Now we have flowlines, waterbodies, hydrologic locations, a
basin boundary, and major rivers downstream to work with. These could be
saved to a local file for use in a GIS or used in some further
analysis.</p>
<p>Say you want to know how to relate NHD data to 3DHP data. 3DHP
hydrolocations include “reachcode” tops and bottoms to hel with that.
Here, we lookup the hydrolocation with reachcode
<code>07070004002889</code>then grab the rest of the reachcode
hydrolocations along the mainstem that the reachcode is part of.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span>  <span class="va">reachcode</span> <span class="op">&lt;-</span> <span class="st">"07070004002889"</span></span>
<span></span>
<span>  <span class="va">hydrolocation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_3dhp.html">get_3dhp</a></span><span class="op">(</span>universalreferenceid <span class="op">=</span> <span class="va">reachcode</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">"reach code, external connection"</span><span class="op">)</span></span>
<span><span class="co">#&gt; https://hydro.nationalmap.gov/arcgis/rest/services/3DHP_all/MapServer/40/query</span></span>
<span><span class="co">#&gt; universalreferenceid IN ('07070004002889')jsontrue</span></span>
<span><span class="co">#&gt; https://hydro.nationalmap.gov/arcgis/rest/services/3DHP_all/MapServer/40/query</span></span>
<span><span class="co">#&gt; 5800707,25271902*geojson</span></span>
<span></span>
<span>  <span class="va">hydrolocation</span></span>
<span><span class="co">#&gt; Simple feature collection with 2 features and 9 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -89.44179 ymin: 43.48568 xmax: -89.43904 ymax: 43.48829</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;    id3dhp   featuredate                                mainstemid</span></span>
<span><span class="co">#&gt; 1 01HAJW7 1694649600000 https://geoconnex.us/ref/mainstems/359842</span></span>
<span><span class="co">#&gt; 2 01SVVYQ 1694649600000 https://geoconnex.us/ref/mainstems/359842</span></span>
<span><span class="co">#&gt;   universalreferenceid gnisid gnisidlabel featuretype featuretypelabel</span></span>
<span><span class="co">#&gt; 1       07070004002889   &lt;NA&gt;        &lt;NA&gt;          10  Reachcode Start</span></span>
<span><span class="co">#&gt; 2       07070004002889   &lt;NA&gt;        &lt;NA&gt;          11    Reachcode End</span></span>
<span><span class="co">#&gt;   workunitid                   geometry</span></span>
<span><span class="co">#&gt; 1       &lt;NA&gt; POINT (-89.44179 43.48829)</span></span>
<span><span class="co">#&gt; 2       &lt;NA&gt; POINT (-89.43904 43.48568)</span></span>
<span></span>
<span>  <span class="va">mainstem_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_3dhp.html">get_3dhp</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="va">hydrolocation</span><span class="op">$</span><span class="va">mainstemid</span>, type <span class="op">=</span> <span class="st">"reach code, external connection"</span><span class="op">)</span></span>
<span><span class="co">#&gt; https://hydro.nationalmap.gov/arcgis/rest/services/3DHP_all/MapServer/40/query</span></span>
<span><span class="co">#&gt; mainstemid IN ('https://geoconnex.us/ref/mainstems/359842', 'https://geoconnex.us/ref/mainstems/359842')jsontrue</span></span>
<span><span class="co">#&gt; https://hydro.nationalmap.gov/arcgis/rest/services/3DHP_all/MapServer/40/query</span></span>
<span><span class="co">#&gt; 5799214,5799215,5799216,5799218,5799219,5799220,5799221,5799222,5799223,5799224,5799225,5799226,5799227,5799228,5799229,5799230,5799231,5799232,5799233,5799234,5799235,5799236,5799237,5799238,5799239,5799240,5799241,5799242,5799243,5799244,5799245,5799246,5799247,5799248,5799249,5799250,5799251,5799258,5799259,5799260,5799261,5799262,5799270,5799271,5799272,5799273,5799274,5799275,5799276,5799277,5799278,5799285,5799286,5799287,5799288,5799289,5799290,5799291,5799292,5799293,5799294,5799295,5799296,5799297,5799298,5799299,5799300,5799301,5799302,5799303,5799304,5799305,5799306,5799307,5799308,5799309,5799869,5799879,5799881,5800191,5800312,5800433,5800442,5800455,5800478,5800484,5800485,5800629,5800633,5800670,5800707,25270409,25270410,25270411,25270413,25270414,25270415,25270416,25270417,25270418,25270419,25270420,25270421,25270422,25270423,25270424,25270425,25270426,25270427,25270428,25270429,25270430,25270431,25270432,25270433,25270434,25270435,25270436,25270437,25270438,25270439,25270440,25270441,25270442,25270443,25270444,25270445,25270446,25270453,25270454,25270455,25270456,25270457,25270465,25270466,25270467,25270468,25270469,25270470,25270471,25270472,25270473,25270480,25270481,25270482,25270483,25270484,25270485,25270486,25270487,25270488,25270489,25270490,25270491,25270492,25270493,25270494,25270495,25270496,25270497,25270498,25270499,25270500,25270501,25270502,25270503,25270504,25271064,25271074,25271076,25271386,25271507,25271628,25271637,25271650,25271673,25271679,25271680,25271824,25271828,25271865,25271902*geojson</span></span>
<span>  <span class="va">mainstem_lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_3dhp.html">get_3dhp</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="va">hydrolocation</span><span class="op">$</span><span class="va">mainstemid</span>, type <span class="op">=</span> <span class="st">"flowline"</span><span class="op">)</span></span>
<span><span class="co">#&gt; https://hydro.nationalmap.gov/arcgis/rest/services/3DHP_all/MapServer/50/query</span></span>
<span><span class="co">#&gt; mainstemid IN ('https://geoconnex.us/ref/mainstems/359842', 'https://geoconnex.us/ref/mainstems/359842')jsontrue</span></span>
<span><span class="co">#&gt; https://hydro.nationalmap.gov/arcgis/rest/services/3DHP_all/MapServer/50/query</span></span>
<span><span class="co">#&gt; 166149,166153,166156,166167,166226,620198,620242,1549503,1549508,1775834,1775872,2002787,2002816,2288867,2288870,2516418,2516420,2516496,2743563,2743647,2743663,2970336,2970404,3197491,3197492,3197514,3197519,3424074,3424099,3651025,3877526,3877599,4104386,4331439,4558446,4558512,4785327,5012065,5012092,5012169,5012174,5012181,5239211,5466418,5466477,5693565,5920117,5920130,5920163,5920221,6374372,6827725,7054423,7054506,7282175,7282198,7282203,7508821,7508844,7508912,7736344,7736366,7884524,7963932,8418465,8647012,8875153,9329690,9329712,9329751,9329758,9329763,9556807,9556840,9784984,9785004,9785058,10013179,10013227,10013285,10013298,10241420,10241494,10468536,10696621,10924194,10924201,10924210,10924307,11152573,11379880,11607428,11607433,11607492,11835528,12063466,12063471,12291441,12291464,12291473,12518287,12518337,12518383,13202390,13430687,13659066,13659070,13659072,13659101,13659163,14115499,14115561,14342674,14342678,14342742,14571352,15026248,15026278,15254035,15481887,15481944,16165429,16165447,16165475,16165491,16165521,16393674,16393676,16621557,16849105,17304165,17304192,17304194,17304201,17304249,17532332,17759883,17987501,18214503,18441913,18670640,18670648,18898970,18898989,19353340,19580366,19580424,19808311,20036860,20036918,20263934,20263936,20492572,20721053,20721069,20948566,21176001,21630720,21630726,21859053,22086419,22314085,22314094,22314130,22542072,22999441,22999515,23226961,23226989,23455619,23684170,23684174,23684225,24240147,24241311,24368049,24595119,24595159,25279723,25508187,25508266,25508280,25734303,25734325,25961872,26189223,26189317,26189337,26416378,26645046,26645051,26873168,26873214,27103181,27103182,27331602,27331618,27331623,27331629,29329570,29556652,29778146,29781477,29784082,30010627*geojson</span></span>
<span></span>
<span>  <span class="va">old_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">pc</span><span class="op">(</span><span class="va">hydrolocation</span><span class="op">)</span>, pch <span class="op">=</span> <span class="st">"o"</span>, col <span class="op">=</span> <span class="st">"#808080BF"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">pc</span><span class="op">(</span><span class="va">mainstem_lines</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="get_3dhp_data_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">old_par</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">old_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/plot_nhdplus.html">plot_nhdplus</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">basin</span><span class="op">$</span><span class="va">basin</span><span class="op">)</span>, flowline_only <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>               plot_config <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>flowline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span>, zoom <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched off</span></span>
<span><span class="co">#&gt; https://api.water.usgs.gov/geoserver/wmadata/ows</span></span>
<span><span class="co">#&gt; &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span>
<span><span class="co">#&gt; &lt;wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:gml="http://www.opengis.net/gml" service="WFS" version="1.1.0" outputFormat="application/json" xsi:schemaLocation="http://www.opengis.net/wfs                         http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"&gt;</span></span>
<span><span class="co">#&gt;   &lt;wfs:Query xmlns:feature="https://api.water.usgs.gov/wmadata" typeName="feature:nhdflowline_network" srsName="EPSG:4269"&gt;</span></span>
<span><span class="co">#&gt;     &lt;ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"&gt;</span></span>
<span><span class="co">#&gt;       &lt;ogc:And&gt;</span></span>
<span><span class="co">#&gt;         &lt;ogc:BBOX&gt;</span></span>
<span><span class="co">#&gt;           &lt;ogc:PropertyName&gt;the_geom&lt;/ogc:PropertyName&gt;</span></span>
<span><span class="co">#&gt;           &lt;gml:Envelope srsName="urn:x-ogc:def:crs:EPSG:4326"&gt;</span></span>
<span><span class="co">#&gt;             &lt;gml:lowerCorner&gt;43.378165219 -90.461663253&lt;/gml:lowerCorner&gt;</span></span>
<span><span class="co">#&gt;             &lt;gml:upperCorner&gt;43.84757169 -89.433984535&lt;/gml:upperCorner&gt;</span></span>
<span><span class="co">#&gt;           &lt;/gml:Envelope&gt;</span></span>
<span><span class="co">#&gt;         &lt;/ogc:BBOX&gt;</span></span>
<span><span class="co">#&gt;       &lt;/ogc:And&gt;</span></span>
<span><span class="co">#&gt;     &lt;/ogc:Filter&gt;</span></span>
<span><span class="co">#&gt;   &lt;/wfs:Query&gt;</span></span>
<span><span class="co">#&gt; &lt;/wfs:GetFeature&gt;</span></span>
<span><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects assumes that they</span></span>
<span><span class="co">#&gt; are planar</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched on</span></span>
<span><span class="co">#&gt; Zoom set to: 10</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">pc</span><span class="op">(</span><span class="va">mainstem_lines</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">pc</span><span class="op">(</span><span class="va">mainstem_points</span><span class="op">)</span>, pch <span class="op">=</span> <span class="st">"o"</span>, col <span class="op">=</span> <span class="st">"#808080BF"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="get_3dhp_data_files/figure-html/unnamed-chunk-3-2.png" width="576"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">old_par</span><span class="op">)</span></span></code></pre></div>
<p>With this functionality, we have what we need to inter operate
between older NHD data and newly released 3DHP data. This service is
brand new and <code>nhdplusTools</code> is just getting going with
functionality to support what’s shown here. Please <a href="https://github.com/DOI-USGS/nhdplusTools/issues" class="external-link">submit issues</a>
if you find problems or have questions!!</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Blodgett, Mike Johnson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
