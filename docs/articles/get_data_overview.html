<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NHDPlusTools Data Access Overview • nhdplusTools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="NHDPlusTools Data Access Overview">
<meta property="og:description" content="nhdplusTools">
<meta property="og:image" content="https://doi-usgs.github.io/nhdplusTools/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nhdplusTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/nhdplusTools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/get_3dhp_data.html">3DHP Data Access</a>
    </li>
    <li>
      <a href="../articles/get_data_overview.html">NHDPlusTools Data Access Overview</a>
    </li>
    <li>
      <a href="../articles/indexing.html">Indexing and Referencing</a>
    </li>
    <li>
      <a href="../articles/nhdplushr.html">Working with NHDPlusHR</a>
    </li>
    <li>
      <a href="../articles/plot_nhdplus.html">Plotting with nhdplusTools</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/doi-usgs/nhdplusTools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>NHDPlusTools Data Access Overview</h1>
                        <h4 data-toc-skip class="author"><a href="mailto:dblodgett@usgs.gov" class="email">dblodgett@usgs.gov</a></h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/doi-usgs/nhdplusTools/blob/HEAD/vignettes/get_data_overview.Rmd" class="external-link"><code>vignettes/get_data_overview.Rmd</code></a></small>
      <div class="hidden name"><code>get_data_overview.Rmd</code></div>

    </div>

    
    
<p>Since it’s original release in 2019, data access in nhdplusTools has
evolved and grown considerably. This vignette, prepared for a workshop
in Summer 2024 shows the diversity of data available with nhdplusTools
in one holistic overview.</p>
<p>The function naming in <code>nhdplusTools</code> related to data
access uses three common terms:<br>
1. “download” will generally download complete data sets for use
locally. 2. “get” will pull a data subset from a web service. 3.
“subset” will pull a subset from a local file and, when available, a web
service.</p>
<div class="section level2">
<h2 id="dataset-function-index-">Dataset function index.<a class="anchor" aria-label="anchor" href="#dataset-function-index-"></a>
</h2>
<p>The following summarizes specific data access functions available for
the datasets that <code>nhdplusTools</code> has supporting functionality
for.</p>
<ul>
<li>NHDPlusV2
<ul>
<li>
<code><a href="../reference/download_nhdplusv2.html">download_nhdplusv2()</a></code> - downloads a National seamless
geodatabase</li>
<li>
<code><a href="../reference/get_nhdplus.html">get_nhdplus()</a></code> - access NHDPlusV2 from a web
service</li>
<li>
<code><a href="../reference/subset_nhdplus.html">subset_nhdplus()</a></code> - subsets the National geodatabase OR
the web service</li>
<li>
<code><a href="../reference/subset_rpu.html">subset_rpu()</a></code> - subsets loaded NHDPlusV2 by raster
processing unit</li>
<li>
<code><a href="../reference/subset_vpu.html">subset_vpu()</a></code> - subsets loaded NHDPlusV2 by vector
processing unit</li>
<li>
<code><a href="../reference/get_boundaries.html">get_boundaries()</a></code> - retrieves NHDPlusV2 processing unit
boundaries</li>
</ul>
</li>
<li>NHDPlusHR
<ul>
<li>
<code><a href="../reference/download_nhdplushr.html">download_nhdplushr()</a></code> - downloads staged
geodatabases</li>
<li>
<code><a href="../reference/get_nhdplushr.html">get_nhdplushr()</a></code> - assembles nhdplushr datasets from
many staged databases</li>
<li>
<code><a href="../reference/get_hr_data.html">get_hr_data()</a></code> - helps pull data out of staged databases
(used by <code><a href="../reference/get_nhdplushr.html">get_nhdplushr()</a></code>)</li>
</ul>
</li>
<li>NHD
<ul>
<li>
<code><a href="../reference/download_nhd.html">download_nhd()</a></code>- downloads staged geodatabases</li>
</ul>
</li>
<li>3DHP
<ul>
<li>
<code>get_3dhp</code> - access 3DHP from a web service</li>
</ul>
</li>
<li>geoconnex
<ul>
<li>
<code><a href="../reference/get_geoconnex_reference.html">get_geoconnex_reference()</a></code> - access geoconnex reference
features from a web service</li>
</ul>
</li>
<li>WBD
<ul>
<li>
<code><a href="../reference/download_wbd.html">download_wbd()</a></code> - download a National WBD
geodatabase</li>
<li>
<code><a href="../reference/get_huc.html">get_huc()</a></code> - get a particular Hydrologic Unit Code from
a service</li>
</ul>
</li>
<li>RF1
<ul>
<li>
<code><a href="../reference/download_rf1.html">download_rf1()</a></code> - download a National RF1
geodatabase</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="network-linked-data-index-integration">Network Linked Data Index integration<a class="anchor" aria-label="anchor" href="#network-linked-data-index-integration"></a>
</h2>
<p>The Network Linked Data Index plays a key role in discovery
<code>nhdplusTools</code>. It provides access to an easy network
navigation and basin boundary delineation tool. Behind the scenes, the
NLDI is based on the network of the NHDPlusV2 – so has some special
functionality related directly to that dataset. Functions that utilize
the NLDI include:</p>
<ul>
<li><code><a href="../reference/subset_nhdplus.html">subset_nhdplus()</a></code></li>
<li><code><a href="../reference/plot_nhdplus.html">plot_nhdplus()</a></code></li>
<li><code><a href="../reference/map_nhdplus.html">map_nhdplus()</a></code></li>
<li><code><a href="../reference/discover_nhdplus_id.html">discover_nhdplus_id()</a></code></li>
<li><code><a href="../reference/get_nldi_basin.html">get_nldi_basin()</a></code></li>
<li><code><a href="../reference/get_nldi_feature.html">get_nldi_feature()</a></code></li>
<li><code><a href="../reference/get_nldi_index.html">get_nldi_index()</a></code></li>
<li><code><a href="../reference/navigate_network.html">navigate_network()</a></code></li>
<li><code><a href="../reference/navigate_nldi.html">navigate_nldi()</a></code></li>
<li><code><a href="../reference/get_split_catchment.html">get_split_catchment()</a></code></li>
<li><code><a href="../reference/get_raindrop_trace.html">get_raindrop_trace()</a></code></li>
</ul>
<p>In the demo below, we’ll choose a stream gage and show how to access
data related to it from all the datasets that nhdplusTools works with as
well as use some of the NLDI functionality in question.</p>
<p>For the sake of demonstration, we’ll look at the Wolf River at
Langlade, WI – site ID “04074950”.</p>
<p>nhdplusTools allows us to start from a stream gage to build a subset
of NHDPlusV2 data. Below, we’ll do just that and plot the results on a
default map.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">demo_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nhdplusTools_data_dir.html">nhdplusTools_data_dir</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">site_id</span> <span class="op">&lt;-</span> <span class="st">"USGS-04074950"</span></span>
<span></span>
<span></span>
<span><span class="co"># use dataRetrieval::get_nldi_sources() to find other nldi sources</span></span>
<span></span>
<span><span class="va">site</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>featureSource <span class="op">=</span> <span class="st">"nwissite"</span>,</span>
<span>             featureID <span class="op">=</span> <span class="st">"USGS-04074950"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">site_feature</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_nldi_feature.html">get_nldi_feature</a></span><span class="op">(</span><span class="va">site</span><span class="op">)</span></span>
<span></span>
<span><span class="va">upstream_network</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/navigate_nldi.html">navigate_nldi</a></span><span class="op">(</span><span class="va">site</span>, </span>
<span>                                  mode <span class="op">=</span> <span class="st">"UT"</span>, distance_km <span class="op">=</span> <span class="fl">9999</span><span class="op">)</span></span>
<span></span>
<span><span class="va">demo_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">demo_dir</span>, <span class="st">"data_demo.gpkg"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subset_nhdplus.html">subset_nhdplus</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">upstream_network</span><span class="op">$</span><span class="va">UT_flowlines</span><span class="op">$</span><span class="va">nhdplus_comid</span><span class="op">)</span>, </span>
<span>                          nhdplus_data <span class="op">=</span> <span class="st">"download"</span>, <span class="co"># download from a service</span></span>
<span>                          output_file <span class="op">=</span> <span class="va">demo_data</span>, <span class="co"># write the data to disk</span></span>
<span>                          return_data <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># return the data rather</span></span>
<span>                          flowline_only <span class="op">=</span> <span class="cn">FALSE</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; All intersections performed in latitude/longitude.</span></span>
<span><span class="co">#&gt; Reading NHDFlowline_Network</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched off</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched on</span></span>
<span><span class="co">#&gt; Writing NHDFlowline_Network</span></span>
<span><span class="co">#&gt; Reading CatchmentSP</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched off</span></span>
<span><span class="co">#&gt; Found invalid geometry, attempting to fix.</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched on</span></span>
<span><span class="co">#&gt; Writing CatchmentSP</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched off</span></span>
<span><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects assumes that they</span></span>
<span><span class="co">#&gt; are planar</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched on</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched off</span></span>
<span><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects assumes that they</span></span>
<span><span class="co">#&gt; are planar</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched on</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched off</span></span>
<span><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects assumes that they</span></span>
<span><span class="co">#&gt; are planar</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched on</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "NHDFlowline_Network"    "CatchmentSP"            "NHDArea"               </span></span>
<span><span class="co">#&gt; [4] "NHDWaterbody"           "NHDFlowline_NonNetwork"</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="va">nrow</span><span class="op">)</span></span>
<span><span class="co">#&gt;    NHDFlowline_Network            CatchmentSP                NHDArea </span></span>
<span><span class="co">#&gt;                    389                    370                     20 </span></span>
<span><span class="co">#&gt;           NHDWaterbody NHDFlowline_NonNetwork </span></span>
<span><span class="co">#&gt;                    473                      8</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">old_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_nhdplus.html">plot_nhdplus</a></span><span class="op">(</span>outlets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>featureSource <span class="op">=</span> <span class="st">"nwissite"</span>,</span>
<span>                            featureID <span class="op">=</span> <span class="st">"USGS-04074950"</span><span class="op">)</span>, </span>
<span>             nhdplus_data <span class="op">=</span> <span class="va">demo_data</span>, flowline_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Zoom set to: 10</span></span>
<span><span class="co">#&gt; Warning in par(old_par): graphical parameter "cin" cannot be set</span></span>
<span><span class="co">#&gt; Warning in par(old_par): graphical parameter "cra" cannot be set</span></span>
<span><span class="co">#&gt; Warning in par(old_par): graphical parameter "csi" cannot be set</span></span>
<span><span class="co">#&gt; Warning in par(old_par): graphical parameter "cxy" cannot be set</span></span>
<span><span class="co">#&gt; Warning in par(old_par): graphical parameter "din" cannot be set</span></span>
<span><span class="co">#&gt; Warning in par(old_par): graphical parameter "page" cannot be set</span></span></code></pre></div>
<p><img src="get_data_overview_files/figure-html/unnamed-chunk-1-1.png" width="576"></p>
<p>The above is the original way NHDPlusTools supported access NHDPlusV2
data. A dedicated web service subset utility is available in
<code>get_nhdplus</code> – which is what <code><a href="../reference/subset_nhdplus.html">subset_nhdplus()</a></code>
calls behind the scenes.</p>
<p>Here we grab the basin for our site and request NHDPlus with its
geometry as the Area of Interest.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">basin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_nldi_basin.html">get_nldi_basin</a></span><span class="op">(</span><span class="va">site</span><span class="op">)</span></span>
<span></span>
<span><span class="va">subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_nhdplus.html">get_nhdplus</a></span><span class="op">(</span>AOI <span class="op">=</span> <span class="va">basin</span>, realization <span class="op">=</span> <span class="st">"flowline"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched off</span></span>
<span><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects assumes that they</span></span>
<span><span class="co">#&gt; are planar</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched on</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">basin</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">subset</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="get_data_overview_files/figure-html/unnamed-chunk-2-1.png" width="576"></p>
<p>For NHDPlusHR data, which is much denser than NHDPlusV2,
<code>nhdplusTools</code> supports downloading four-digit Hydrologic
Unit Code staged geodatabases. The function <code><a href="../reference/get_huc.html">get_huc()</a></code> is
useful to discover the code needed here.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">wolf_huc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_huc.html">get_huc</a></span><span class="op">(</span><span class="va">basin</span>, type <span class="op">=</span> <span class="st">'huc04'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched off</span></span>
<span><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects assumes that they</span></span>
<span><span class="co">#&gt; are planar</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched on</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">wolf_huc</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># it straddles hucs? Not really.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">basin</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">wolf_huc</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="get_data_overview_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">wolf_huc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_huc.html">get_huc</a></span><span class="op">(</span><span class="va">site_feature</span>, type <span class="op">=</span> <span class="st">"huc04"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched off</span></span>
<span><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects assumes that they</span></span>
<span><span class="co">#&gt; are planar</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched on</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">wolf_huc</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># better!!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">wolf_huc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">basin</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"grey"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="get_data_overview_files/figure-html/unnamed-chunk-3-2.png" width="576"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">outdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="../reference/nhdplusTools_data_dir.html">nhdplusTools_data_dir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"hr_access_demo"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">outdir</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in dir.create(outdir):</span></span>
<span><span class="co">#&gt; 'C:\Users\dblodgett\AppData\Roaming\R\data\R\nhdplusTools\hr_access_demo'</span></span>
<span><span class="co">#&gt; already exists</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">download_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_nhdplushr.html">download_nhdplushr</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="va">wolf_huc</span><span class="op">$</span><span class="va">huc4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">download_dir</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "NHDPLUS_H_0403_HU4_GDB.gdb" "NHDPLUS_H_0403_HU4_GDB.jpg"</span></span>
<span><span class="co">#&gt; [3] "NHDPLUS_H_0403_HU4_GDB.xml"</span></span></code></pre></div>
<p>If we had asked for more HUC4 codes, additional gdb files would be in
the directory we specified.</p>
<p>With this, we can use one of the two functions for access NHDPlusHR
data to load data from the directory. Here, we use the more complete
<code><a href="../reference/get_nhdplus.html">get_nhdplus()</a></code> and set <code>check_terminals=TRUE</code>
which uses <code><a href="../reference/make_standalone.html">make_standalone()</a></code> to ensure that the nhdplus
attributes are complete and self-consistent within the subset of data
returned.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">nhdplushr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_nhdplushr.html">get_nhdplushr</a></span><span class="op">(</span></span>
<span>  <span class="va">download_dir</span>, </span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NHDFlowline"</span>, <span class="st">"NHDPlusCatchment"</span>, <span class="st">"NHDWaterbody"</span>, </span>
<span>             <span class="st">"NHDArea"</span>, <span class="st">"NHDLine"</span>, <span class="st">"NHDPlusSink"</span>, <span class="st">"NHDPlusWall"</span>, </span>
<span>             <span class="st">"NHDPoint"</span>, <span class="st">"NHDPlusBurnWaterbody"</span>, <span class="st">"NHDPlusBurnLineEvent"</span>,</span>
<span>             <span class="st">"HYDRO_NET_Junctions"</span>, <span class="st">"WBDHU2"</span>, <span class="st">"WBDHU4"</span>,<span class="st">"WBDHU6"</span>, </span>
<span>             <span class="st">"WBDHU8"</span>, <span class="st">"WBDHU10"</span>, <span class="st">"WBDHU12"</span>, <span class="st">"WBDLine"</span><span class="op">)</span>, </span>
<span>  check_terminals <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in CPL_read_ogr(dsn, layer, query, as.character(options), quiet, : GDAL</span></span>
<span><span class="co">#&gt; Message 1: organizePolygons() received a polygon with more than 100 parts. The</span></span>
<span><span class="co">#&gt; processing may be really slow.  You can skip the processing by setting</span></span>
<span><span class="co">#&gt; METHOD=SKIP, or only make it analyze counter-clock wise parts by setting</span></span>
<span><span class="co">#&gt; METHOD=ONLY_CCW if you can assume that the outline of holes is counter-clock</span></span>
<span><span class="co">#&gt; wise defined</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">nhdplushr</span>, <span class="va">nrow</span><span class="op">)</span></span>
<span><span class="co">#&gt;          NHDFlowline     NHDPlusCatchment         NHDWaterbody </span></span>
<span><span class="co">#&gt;                53834                51815                34138 </span></span>
<span><span class="co">#&gt;              NHDArea              NHDLine          NHDPlusSink </span></span>
<span><span class="co">#&gt;                 1283                  207                  582 </span></span>
<span><span class="co">#&gt;          NHDPlusWall             NHDPoint NHDPlusBurnWaterbody </span></span>
<span><span class="co">#&gt;                 2031                   73                25146 </span></span>
<span><span class="co">#&gt; NHDPlusBurnLineEvent  HYDRO_NET_Junctions               WBDHU2 </span></span>
<span><span class="co">#&gt;                51938                53555                    1 </span></span>
<span><span class="co">#&gt;               WBDHU4               WBDHU6               WBDHU8 </span></span>
<span><span class="co">#&gt;                    1                    2                   18 </span></span>
<span><span class="co">#&gt;              WBDHU10              WBDHU12              WBDLine </span></span>
<span><span class="co">#&gt;                  107                  629                 2031</span></span></code></pre></div>
<p>At a lower level, we can use <code><a href="../reference/get_hr_data.html">get_hr_data()</a></code> to access
particular layers. Here, <code>rename=TRUE</code> causes the nhdplushr
names to be normalized to <code>nhdplusTools</code> conventions using
<code><a href="../reference/align_nhdplus_names.html">align_nhdplus_names()</a></code>.</p>
<p>NOTE: “NHDPlusID” from nhdplushr is replaced with the name “COMID”.
This attribute is merely a unique integer identifier and should not be
assumed to relate to anything outside the context of a given
dataset.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">nhdplushr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_hr_data.html">get_hr_data</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">download_dir</span>, pattern <span class="op">=</span> <span class="st">".gdb"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                         layer <span class="op">=</span> <span class="st">"NHDFlowline"</span>, rename <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">nhdplushr</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Permanent_Identifier"        "FDate"                      </span></span>
<span><span class="co">#&gt;  [3] "Resolution"                  "GNIS_ID"                    </span></span>
<span><span class="co">#&gt;  [5] "GNIS_Name"                   "LENGTHKM"                   </span></span>
<span><span class="co">#&gt;  [7] "REACHCODE"                   "FlowDir"                    </span></span>
<span><span class="co">#&gt;  [9] "WBArea_Permanent_Identifier" "FTYPE"                      </span></span>
<span><span class="co">#&gt; [11] "FCODE"                       "MainPath"                   </span></span>
<span><span class="co">#&gt; [13] "InNetwork"                   "VisibilityFilter"           </span></span>
<span><span class="co">#&gt; [15] "Shape_Length"                "COMID"                      </span></span>
<span><span class="co">#&gt; [17] "VPUID"                       "Enabled"                    </span></span>
<span><span class="co">#&gt; [19] "Shape"                       "StreamLeve"                 </span></span>
<span><span class="co">#&gt; [21] "StreamOrde"                  "StreamCalc"                 </span></span>
<span><span class="co">#&gt; [23] "FromNode"                    "ToNode"                     </span></span>
<span><span class="co">#&gt; [25] "Hydroseq"                    "LevelPathI"                 </span></span>
<span><span class="co">#&gt; [27] "Pathlength"                  "TerminalPa"                 </span></span>
<span><span class="co">#&gt; [29] "ArbolateSu"                  "Divergence"                 </span></span>
<span><span class="co">#&gt; [31] "StartFlag"                   "TerminalFl"                 </span></span>
<span><span class="co">#&gt; [33] "UpLevelPat"                  "UpHydroseq"                 </span></span>
<span><span class="co">#&gt; [35] "DnLevel"                     "DnLevelPat"                 </span></span>
<span><span class="co">#&gt; [37] "DnHydroseq"                  "DnMinorHyd"                 </span></span>
<span><span class="co">#&gt; [39] "DnDrainCou"                  "FromMeas"                   </span></span>
<span><span class="co">#&gt; [41] "ToMeas"                      "RtnDiv"                     </span></span>
<span><span class="co">#&gt; [43] "Thinner"                     "VPUIn"                      </span></span>
<span><span class="co">#&gt; [45] "VPUOut"                      "AreaSqKM"                   </span></span>
<span><span class="co">#&gt; [47] "TotDASqKM"                   "DivDASqKm"                  </span></span>
<span><span class="co">#&gt; [49] "MaxElevRaw"                  "MinElevRaw"                 </span></span>
<span><span class="co">#&gt; [51] "MaxElevSmo"                  "MinElevSmo"                 </span></span>
<span><span class="co">#&gt; [53] "Slope"                       "SlopeLenKm"                 </span></span>
<span><span class="co">#&gt; [55] "ElevFixed"                   "HWType"                     </span></span>
<span><span class="co">#&gt; [57] "HWNodeSqKm"                  "StatusFlag"</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Great Lakes coast are flowlines -- remove for visuals</span></span>
<span><span class="va">gl_coast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_DM.html">get_DM</a></span><span class="op">(</span><span class="va">nhdplushr</span>, <span class="fl">60002700000331</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="../reference/get_DM.html">get_DM</a></span><span class="op">(</span><span class="va">nhdplushr</span>, <span class="fl">60002700049157</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; defaulting to comid rather than permanent_identifier</span></span>
<span><span class="co">#&gt; defaulting to comid rather than permanent_identifier</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">nhdplushr</span>, <span class="va">FCODE</span> <span class="op">!=</span> <span class="fl">56600</span> <span class="op">&amp;</span> <span class="va">StreamOrde</span> <span class="op">&gt;</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">COMID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">gl_coast</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">wolf_huc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">basin</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"grey"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="va">plot_data</span><span class="op">$</span><span class="va">StreamOrde</span> <span class="op">/</span> <span class="fl">3</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="get_data_overview_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">basin</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="va">plot_data</span><span class="op">$</span><span class="va">StreamOrde</span> <span class="op">/</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="get_data_overview_files/figure-html/unnamed-chunk-6-2.png" width="576">
BONUS DEMO: Say we want to know where our stream gage is on the river in
question…</p>
<p><code><a href="../reference/get_flowline_index.html">get_flowline_index()</a></code> and
<code><a href="../reference/disambiguate_flowline_indexes.html">disambiguate_flowline_indexes()</a></code> are your friends.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">potential_matches</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_flowline_index.html">get_flowline_index</a></span><span class="op">(</span><span class="va">nhdplushr</span>, </span>
<span>                                        points <span class="op">=</span> <span class="va">site_feature</span>, </span>
<span>                                        search_radius <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">as_units</a></span><span class="op">(</span><span class="fl">500</span>, <span class="st">"m"</span><span class="op">)</span>,</span>
<span>                                        max_matches <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; defaulting to comid rather than permanent_identifier</span></span>
<span><span class="co">#&gt; Warning in match_crs(x, points, paste("crs of lines and points don't match.", :</span></span>
<span><span class="co">#&gt; crs of lines and points don't match. attempting st_transform of lines</span></span>
<span><span class="co">#&gt; Warning in index_points_to_lines.hy(x, points, search_radius = search_radius, :</span></span>
<span><span class="co">#&gt; converting to LINESTRING, this may be slow, check results</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">potential_matches</span></span>
<span><span class="co">#&gt;   id          COMID      REACHCODE REACH_meas       offset</span></span>
<span><span class="co">#&gt; 1  1 60002700035364 04030202000126    34.9737 0.0002166323</span></span>
<span><span class="co">#&gt; 2  1 60002700000908 04030104001542    49.1370 0.0177673341</span></span>
<span><span class="co">#&gt; 3  1 60002700036849 04030104001542    81.5378 0.0224609122</span></span>
<span><span class="co">#&gt; 4  1 60002700035750 04030104000533    31.4940 0.0244823037</span></span>
<span><span class="co">#&gt; 5  1 60002700034888 04030104000136   100.0000 0.0247855142</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">site_meta</span> <span class="op">&lt;-</span> <span class="fu">dataRetrieval</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISsite.html" class="external-link">readNWISsite</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"USGS-"</span>, <span class="st">""</span>, <span class="va">site_feature</span><span class="op">$</span><span class="va">identifier</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sqmi_to_sqkm</span> <span class="op">&lt;-</span> <span class="fl">2.59</span></span>
<span></span>
<span><span class="va">da_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span>, drainagearea <span class="op">=</span> <span class="va">site_meta</span><span class="op">$</span><span class="va">drain_area_va</span> <span class="op">*</span> <span class="va">sqmi_to_sqkm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># uses nearest drainage area match</span></span>
<span><span class="fu"><a href="../reference/disambiguate_flowline_indexes.html">disambiguate_flowline_indexes</a></span><span class="op">(</span><span class="va">potential_matches</span>,</span>
<span>                              flowpath <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">nhdplushr</span>, <span class="va">COMID</span>, <span class="va">TotDASqKM</span><span class="op">)</span>,</span>
<span>                              hydro_location <span class="op">=</span> <span class="va">da_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">#&gt;      id   COMID REACHCODE      REACH_meas   offset</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 6.00<span style="color: #949494;">e</span>13 04030202000126       35.0 0.000<span style="text-decoration: underline;">217</span></span></span></code></pre></div>
<p>If what you really need is the base NHD, which is now a static
dataset, the pattern is just the same as with nhdplushr using
<code><a href="../reference/download_nhd.html">download_nhd()</a></code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">outdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="../reference/nhdplusTools_data_dir.html">nhdplusTools_data_dir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"nhd_access_demo"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">outdir</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in dir.create(outdir):</span></span>
<span><span class="co">#&gt; 'C:\Users\dblodgett\AppData\Roaming\R\data\R\nhdplusTools\nhd_access_demo'</span></span>
<span><span class="co">#&gt; already exists</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">download_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_nhd.html">download_nhd</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="va">wolf_huc</span><span class="op">$</span><span class="va">huc4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">download_dir</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "NHD_H_0403_HU4_GDB.gdb" "NHD_H_0403_HU4_GDB.jpg" "NHD_H_0403_HU4_GDB.xml"</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">nhd_gdb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">download_dir</span>, pattern <span class="op">=</span> <span class="st">".gdb"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_layers.html" class="external-link">st_layers</a></span><span class="op">(</span><span class="va">nhd_gdb</span><span class="op">)</span></span>
<span><span class="co">#&gt; Driver: OpenFileGDB </span></span>
<span><span class="co">#&gt; Available layers:</span></span>
<span><span class="co">#&gt;                 layer_name                 geometry_type features fields</span></span>
<span><span class="co">#&gt; 1        ExternalCrosswalk                            NA        1      6</span></span>
<span><span class="co">#&gt; 2                 NHDFCode                            NA      126     13</span></span>
<span><span class="co">#&gt; 3     NHDFeatureToMetadata                            NA   277698      2</span></span>
<span><span class="co">#&gt; 4                  NHDFlow                            NA    67048      4</span></span>
<span><span class="co">#&gt; 5           NHDFlowlineVAA                            NA    53733     22</span></span>
<span><span class="co">#&gt; 6              NHDMetadata                            NA      312     21</span></span>
<span><span class="co">#&gt; 7  NHDProcessingParameters                            NA        5      2</span></span>
<span><span class="co">#&gt; 8  NHDReachCodeMaintenance                            NA    62818      6</span></span>
<span><span class="co">#&gt; 9   NHDReachCrossReference                            NA    78278     11</span></span>
<span><span class="co">#&gt; 10       NHDSourceCitation                            NA      350     13</span></span>
<span><span class="co">#&gt; 11               NHDStatus                            NA        0      3</span></span>
<span><span class="co">#&gt; 12 NHDVerticalRelationship                            NA        0      3</span></span>
<span><span class="co">#&gt; 13                CLIPPOLY                 Multi Polygon        0      2</span></span>
<span><span class="co">#&gt; 14            NHDWaterbody              3D Multi Polygon    34143     13</span></span>
<span><span class="co">#&gt; 15         NHDPointEventFC                         Point     2705     14</span></span>
<span><span class="co">#&gt; 16                NHDPoint                      3D Point       74      8</span></span>
<span><span class="co">#&gt; 17          NHDLineEventFC             Multi Line String        0     16</span></span>
<span><span class="co">#&gt; 18                 NHDLine          3D Multi Line String      207     10</span></span>
<span><span class="co">#&gt; 19             NHDFlowline 3D Measured Multi Line String    53850     16</span></span>
<span><span class="co">#&gt; 20          NHDAreaEventFC                 Multi Polygon        0     14</span></span>
<span><span class="co">#&gt; 21                 NHDArea              3D Multi Polygon     1283     12</span></span>
<span><span class="co">#&gt; 22                 WBDLine             Multi Line String     2970      7</span></span>
<span><span class="co">#&gt; 23                  WBDHU8                 Multi Polygon       18     14</span></span>
<span><span class="co">#&gt; 24                  WBDHU6                 Multi Polygon        2     14</span></span>
<span><span class="co">#&gt; 25                  WBDHU4                 Multi Polygon        1     14</span></span>
<span><span class="co">#&gt; 26                  WBDHU2                 Multi Polygon        1     14</span></span>
<span><span class="co">#&gt; 27                 WBDHU16                 Multi Polygon        0     19</span></span>
<span><span class="co">#&gt; 28                 WBDHU14                 Multi Polygon        0     19</span></span>
<span><span class="co">#&gt; 29                 WBDHU12                 Multi Polygon      629     19</span></span>
<span><span class="co">#&gt; 30                 WBDHU10                 Multi Polygon      107     16</span></span>
<span><span class="co">#&gt; 31     HYDRO_NET_Junctions                         Point    53573      1</span></span>
<span><span class="co">#&gt; 32      HYDRO_NET_BUILDERR                            NA       21      3</span></span>
<span><span class="co">#&gt; 33                N_1_Desc                            NA   107423      5</span></span>
<span><span class="co">#&gt; 34               N_1_EDesc                            NA       40      2</span></span>
<span><span class="co">#&gt; 35             N_1_EStatus                            NA        1      2</span></span>
<span><span class="co">#&gt; 36               N_1_ETopo                            NA       14      2</span></span>
<span><span class="co">#&gt; 37              N_1_FloDir                            NA        1      2</span></span>
<span><span class="co">#&gt; 38               N_1_JDesc                            NA       40      2</span></span>
<span><span class="co">#&gt; 39             N_1_JStatus                            NA        1      2</span></span>
<span><span class="co">#&gt; 40               N_1_JTopo                            NA      105      2</span></span>
<span><span class="co">#&gt; 41              N_1_JTopo2                            NA        1      2</span></span>
<span><span class="co">#&gt; 42               N_1_Props                            NA        9      2</span></span>
<span><span class="co">#&gt;                 crs_name</span></span>
<span><span class="co">#&gt; 1                   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2                   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3                   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4                   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5                   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6                   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 7                   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 8                   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 9                   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 13                 NAD83</span></span>
<span><span class="co">#&gt; 14 NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 15 NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 16 NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 17 NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 18 NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 19 NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 20 NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 21 NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 22                 NAD83</span></span>
<span><span class="co">#&gt; 23                 NAD83</span></span>
<span><span class="co">#&gt; 24                 NAD83</span></span>
<span><span class="co">#&gt; 25                 NAD83</span></span>
<span><span class="co">#&gt; 26                 NAD83</span></span>
<span><span class="co">#&gt; 27                 NAD83</span></span>
<span><span class="co">#&gt; 28                 NAD83</span></span>
<span><span class="co">#&gt; 29                 NAD83</span></span>
<span><span class="co">#&gt; 30                 NAD83</span></span>
<span><span class="co">#&gt; 31 NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 32                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 33                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 34                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 35                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 36                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 37                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 38                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 39                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 40                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 41                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 42                  &lt;NA&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">nhd_fline</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">nhd_gdb</span>, <span class="st">"NHDFlowline"</span><span class="op">)</span></span></code></pre></div>
<p>We’ll wait to plot this up until after we’ve done some work with
3DHP. As of writing, the 3DHP is more or less the same as the NHD but in
a new database schema. The <code><a href="../reference/get_3dhp.html">get_3dhp()</a></code> uses a web service to
pull data for subsets much the same as the other <code>get_*</code>
functions. See <code>vignette("get_3dhp_data.Rmd")</code> for more on
how to work with 3DHP data.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sub_3dhp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_3dhp.html">get_3dhp</a></span><span class="op">(</span><span class="va">basin</span>, type <span class="op">=</span> <span class="st">"flowline"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Getting features 0 to 2000 of 2199</span></span>
<span><span class="co">#&gt; Getting features 2000 to 2199 of 2199</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sub_3dhp</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: plotting the first 10 out of 35 attributes; use max.plot = 35 to plot</span></span>
<span><span class="co">#&gt; all</span></span></code></pre></div>
<p><img src="get_data_overview_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sub_3dhp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://doi-usgs.github.io/hydroloom/reference/st_compatibalize.html" class="external-link">st_compatibalize</a></span><span class="op">(</span><span class="va">sub_3dhp</span>, <span class="va">nhd_fline</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">basin</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_zm.html" class="external-link">st_zm</a></span><span class="op">(</span><span class="va">sub_3dhp</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"skyblue"</span>, lwd <span class="op">=</span> <span class="fl">2.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_zm.html" class="external-link">st_zm</a></span><span class="op">(</span><span class="va">nhd_fline</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, lwd <span class="op">=</span> <span class="fl">0.1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="get_data_overview_files/figure-html/unnamed-chunk-9-2.png" width="576"></p>
<p>A brand new, May 2024, feature in nhdplusTools is access to the
geoconnex.us reference feature server. The reference feature server
provides easy access to representations of datasets that people use to
cross reference other data. <code><a href="../reference/discover_geoconnex_reference.html">discover_geoconnex_reference()</a></code>
provides access to a full table of what’s available.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="../reference/discover_geoconnex_reference.html">discover_geoconnex_reference</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"title"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 18 × 2</span></span></span>
<span><span class="co">#&gt;    id            title                                                          </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> hu02          HU02                                                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> hu04          HU04                                                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> hu06          HU06                                                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> hu08          HU08                                                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> hu10          HU10                                                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> nat_aq        USGS National Aquifers                                         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> principal_aq  USGS Principal Aquifers                                        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> sec_hydrg_reg USGS Secondary Hydrogeologic Regions                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> gages         Reference Gages                                                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> mainstems     Reference Mainstems                                            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> dams          Reference Dams                                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> pws           Public Water Systems                                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> states        States                                                         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> counties      Counties                                                       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> aiannh        American Indian/Alaska Native Areas/Hawaiian Home Lands (AIANN…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> cbsa          Core-based statistical areas (CBSA)                            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> ua10          Urban Areas                                                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> places        Places</span></span></code></pre></div>
<p>Each of these sets of “reference features” includes a “uri” which is
a persistent way to identify these features and will always lead you
back to a representation of the feature when you look it up.</p>
<p>For example, let’s get a subset of data for our Wolf River basin.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">wolf_gages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geoconnex_reference.html">get_geoconnex_reference</a></span><span class="op">(</span><span class="va">basin</span>, type <span class="op">=</span> <span class="st">"gages"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting download of first set of features.</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">geoconnex_gage</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">wolf_gages</span>, </span>
<span>                                <span class="va">provider_id</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"USGS-"</span>, <span class="st">""</span>, <span class="va">site_feature</span><span class="op">$</span><span class="va">identifier</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wolf_mainstems</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geoconnex_reference.html">get_geoconnex_reference</a></span><span class="op">(</span><span class="va">basin</span>, type <span class="op">=</span> <span class="st">"mainstems"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting download of first set of features.</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">wolf_mainstem</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">wolf_mainstems</span>, <span class="va">uri</span> <span class="op">==</span> <span class="va">geoconnex_gage</span><span class="op">$</span><span class="va">mainstem_uri</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">basin</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">wolf_mainstems</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">0.5</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">wolf_mainstem</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">3</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">wolf_gages</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">0.75</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">geoconnex_gage</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">17</span>, cex <span class="op">=</span> <span class="fl">1.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="get_data_overview_files/figure-html/unnamed-chunk-11-1.png" width="576">
The Watershed Boundary Dataset contains hydrologic units that are used
as cataloging units for the country. It was developed and improved over
the last twenty years and is nearing a complete static state. There are
three prominent versions of it available – a snapshot available as part
of the NHDPlusV2, a snapshot available as part of and retrieved with
<code><a href="../reference/get_huc.html">get_huc()</a></code>, and the latest (soon to be final) snapshot
available using <code><a href="../reference/download_wbd.html">download_wbd()</a></code>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">wbd_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="../reference/nhdplusTools_data_dir.html">nhdplusTools_data_dir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"wbd_access_demo"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">wbd_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_wbd.html">download_wbd</a></span><span class="op">(</span><span class="va">wbd_dir</span><span class="op">)</span></span>
<span><span class="co">#&gt; Compressed WBD file already exists ...</span></span>
<span><span class="co">#&gt; Extracting data ...</span></span>
<span><span class="co">#&gt; Error in zip::unzip(file, exdir = outdir, overwrite = FALSE) : </span></span>
<span><span class="co">#&gt;   zip error: Cannot open zip file `C:\Users\dblodgett\AppData\Roaming\R\data\R\nhdplusTools\wbd_access_demo\WBD_National_GDB.zip` for reading in file zip.c:141</span></span>
<span><span class="co">#&gt; WBD data extracted to: C:\Users\dblodgett\AppData\Roaming/R/data/R/nhdplusTools/wbd_access_demo/WBD_National_GDB.gdb</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># zip::unzip doesn't always work</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">wbd_out</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">wbd_dir</span>, pattern <span class="op">=</span> <span class="st">".zip"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  </span>
<span>  </span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="va">f</span>, exdir <span class="op">=</span> <span class="va">wbd_dir</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">wbd_gdb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">wbd_dir</span>, pattern <span class="op">=</span> <span class="st">".gdb"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_layers.html" class="external-link">st_layers</a></span><span class="op">(</span><span class="va">wbd_gdb</span><span class="op">)</span></span>
<span><span class="co">#&gt; Driver: OpenFileGDB </span></span>
<span><span class="co">#&gt; Available layers:</span></span>
<span><span class="co">#&gt;                     layer_name     geometry_type features fields</span></span>
<span><span class="co">#&gt; 1                      WBDHU12     Multi Polygon   103025     20</span></span>
<span><span class="co">#&gt; 2             NWISDrainageLine Multi Line String   127876     12</span></span>
<span><span class="co">#&gt; 3                       WBDHU8     Multi Polygon     2413     15</span></span>
<span><span class="co">#&gt; 4  NonContributingDrainageLine Multi Line String        0     10</span></span>
<span><span class="co">#&gt; 5                       WBDHU4     Multi Polygon      245     15</span></span>
<span><span class="co">#&gt; 6                      WBDHU16     Multi Polygon     7202     20</span></span>
<span><span class="co">#&gt; 7  NonContributingDrainageArea     Multi Polygon        0     12</span></span>
<span><span class="co">#&gt; 8             NWISDrainageArea     Multi Polygon     2733     19</span></span>
<span><span class="co">#&gt; 9                       WBDHU6     Multi Polygon      405     15</span></span>
<span><span class="co">#&gt; 10                      WBDHU2     Multi Polygon       22     15</span></span>
<span><span class="co">#&gt; 11                     WBDHU14     Multi Polygon     8138     20</span></span>
<span><span class="co">#&gt; 12                     WBDLine Multi Line String   395030      8</span></span>
<span><span class="co">#&gt; 13                     WBDHU10     Multi Polygon    18867     17</span></span>
<span><span class="co">#&gt; 14           FeatureToMetadata                NA   441934      3</span></span>
<span><span class="co">#&gt; 15           ExternalCrosswalk                NA        0      7</span></span>
<span><span class="co">#&gt; 16                       HUMod                NA       23      5</span></span>
<span><span class="co">#&gt; 17           MetaProcessDetail                NA     1805     16</span></span>
<span><span class="co">#&gt; 18            MetaSourceDetail                NA     1808     27</span></span>
<span><span class="co">#&gt; 19        ProcessingParameters                NA        2      2</span></span>
<span><span class="co">#&gt; 20                UpdateStatus                NA        0      2</span></span>
<span><span class="co">#&gt;                 crs_name</span></span>
<span><span class="co">#&gt; 1  NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 2  NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 3  NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 4  NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 5  NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 6  NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 7  NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 8  NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 9  NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 10 NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 11 NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 12 NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 13 NAD83 + NAVD88 height</span></span>
<span><span class="co">#&gt; 14                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 15                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 16                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 17                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 18                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 19                  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 20                  &lt;NA&gt;</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Blodgett, Mike Johnson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
