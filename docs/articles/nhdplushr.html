<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with NHDPlusHR • nhdplusTools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working with NHDPlusHR">
<meta property="og:description" content="nhdplusTools">
<meta property="og:image" content="https://usgs-r.github.io/nhdplusTools/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nhdplusTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.14</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/nhdplusTools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/nhdplushr.html">Working with NHDPlusHR</a>
    </li>
    <li>
      <a href="../articles/plot_nhdplus.html">Plotting with nhdplusTools</a>
    </li>
    <li>
      <a href="../articles/point_indexing.html">Indexing and Referencing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/usgs-r/nhdplusTools/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="nhdplushr_files/header-attrs-2.3/header-attrs.js"></script><script src="nhdplushr_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with NHDPlusHR</h1>
                        <h4 class="author"><a href="mailto:dblodgett@usgs.gov" class="email">dblodgett@usgs.gov</a></h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/usgs-r/nhdplusTools/blob/master/vignettes/nhdplushr.Rmd"><code>vignettes/nhdplushr.Rmd</code></a></small>
      <div class="hidden name"><code>nhdplushr.Rmd</code></div>

    </div>

    
    
<div id="tldr" class="section level2">
<h2 class="hasAnchor">
<a href="#tldr" class="anchor"></a>TL;DR;</h2>
<p>Most functions in <code>nhdplusTools</code> work with NHDPlus High Res (HR) the same as they do with medium res. The demo below shows how to get a single four-digit hydrologic unit worth of HR data, index a point to it, subset it, and plot the results.</p>
<p><em>Note: For consistency, identifiers from NHDPlusV2 are used with HiRes data. A future release of nhdplusTools may alter this behavior.</em></p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">nhdplusTools</span>)</pre></body></html></div>
<pre><code>#&gt; USGS Support Package: https://owi.usgs.gov/R/packages.html#support</code></pre>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">sf</span>)</pre></body></html></div>
<pre><code>#&gt; Linking to GEOS 3.8.1, GDAL 3.1.0, PROJ 6.3.2</code></pre>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">work_dir</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>(<span class="kw">check</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">sample_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/sample_natseamless.gpkg"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"nhdplusTools"</span>)

<span class="no">hr_gpkg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">work_dir</span>, <span class="st">"hr_data.gpkg"</span>)

<span class="co"># Make a plot and get some background NHDPlusV2 data.</span>
<span class="no">plot_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/plot_nhdplus.html">plot_nhdplus</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"nwissite"</span>, <span class="st">"USGS-05428500"</span>), <span class="kw">streamorder</span> <span class="kw">=</span> <span class="fl">3</span>,
                          <span class="kw">nhdplus_data</span> <span class="kw">=</span> <span class="no">sample_data</span>,
                          <span class="kw">stoponlargerequest</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Zoom: 11</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs

#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Map tiles by Carto, under CC BY 3.0. Data by OpenStreetMap, under ODbL.</code></pre>
<pre><code>#&gt; Audotdetect projection: assuming Google Mercator (epsg 3857)</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs

#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<p><img src="nhdplushr_files/figure-html/tldr-1.png" width="816"></p>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="co"># Find the HU04 we are interested in.</span>
<span class="no">hu04</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span>(<span class="no">plot_data</span>$<span class="no">flowline</span>$<span class="no">REACHCODE</span>, <span class="fl">1</span>, <span class="fl">4</span>))

<span class="co"># Download some NHDPlusHR Data</span>
<span class="no">hr_data_dir</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/download_nhdplushr.html">download_nhdplushr</a></span>(<span class="no">work_dir</span>, <span class="no">hu04</span>)

<span class="co"># Projection and simplification for demo purposes.</span>
<span class="no">hr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_nhdplushr.html">get_nhdplushr</a></span>(<span class="no">work_dir</span>, <span class="kw">out_gpkg</span> <span class="kw">=</span> <span class="no">hr_gpkg</span>,
                    <span class="kw">proj</span> <span class="kw">=</span> <span class="fl">3857</span>)

(<span class="no">start_index</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_flowline_index.html">get_flowline_index</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_transform.html">st_transform</a></span>(<span class="no">hr</span>$<span class="no">NHDFlowline</span>, <span class="fl">5070</span>),
                                   <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_transform.html">st_transform</a></span>(<span class="no">plot_data</span>$<span class="no">outlets</span>, <span class="fl">5070</span>),
                                   <span class="kw">search_radius</span> <span class="kw">=</span> <span class="fl">200</span>)) <span class="co"># meters albers eq area</span></pre></body></html></div>
<pre><code>#&gt;            COMID      REACHCODE REACH_meas   offset
#&gt; 1 22001000032700 07090002006114    37.6572 87.66852</code></pre>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="no">ids</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_UT.html">get_UT</a></span>(<span class="no">hr</span>$<span class="no">NHDFlowline</span>, <span class="no">start_index</span>$<span class="no">COMID</span>)

<span class="no">hr_subset</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/subset_nhdplus.html">subset_nhdplus</a></span>(<span class="no">ids</span>, <span class="kw">nhdplus_data</span> <span class="kw">=</span> <span class="no">hr_gpkg</span>)</pre></body></html></div>
<pre><code>#&gt; All intersections performed in latitude/longitude.</code></pre>
<pre><code>#&gt; Reading NHDFlowline</code></pre>
<pre><code>#&gt; Writing NHDFlowline</code></pre>
<pre><code>#&gt; Reading NHDPlusCatchment</code></pre>
<pre><code>#&gt; Writing NHDPlusCatchment</code></pre>
<p>Now that we have both a four digit hydrologic unit worth of NHDPlusHR data and a subset upstream of a point of interest, we can plot things up and see what it looks like. This plot uses NHDPlusV2 as returned by <code><a href="../reference/plot_nhdplus.html">plot_nhdplus()</a></code> as a base layer and adds NHDPlusHR data on top of it.</p>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_nhdplus.html">plot_nhdplus</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"nwissite"</span>, <span class="st">"USGS-05428500"</span>), <span class="kw">streamorder</span> <span class="kw">=</span> <span class="fl">2</span>,
             <span class="kw">nhdplus_data</span> <span class="kw">=</span> <span class="no">sample_data</span>, <span class="kw">overwrite</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
             <span class="kw">plot_config</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">flowline</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">2.5</span>),
                                <span class="kw">basin</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">3</span>)),
             <span class="kw">stoponlargerequest</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Zoom: 11</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs

#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Map tiles by Carto, under CC BY 3.0. Data by OpenStreetMap, under ODbL.</code></pre>
<pre><code>#&gt; Audotdetect projection: assuming Google Mercator (epsg 3857)</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs

#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; ellps WGS 84 in CRS definition: +proj=merc +a=6378137 +b=6378137 +lat_ts=0
#&gt; +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<pre><code>#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded
#&gt; datum WGS_1984 in CRS definition</code></pre>
<div class="sourceCode" id="cb77"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="no">hr</span>$<span class="no">NHDPlusCatchment</span>), <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">0.25</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="no">hr</span>$<span class="no">NHDFlowline</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="st">"blue"</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_transform.html">st_transform</a></span>(<span class="no">hr_subset</span>$<span class="no">NHDFlowline</span>, <span class="fl">3857</span>)),
     <span class="kw">col</span> <span class="kw">=</span> <span class="st">"cyan"</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="nhdplushr_files/figure-html/plot-1.png" width="816"></p>
</div>
<div id="download" class="section level2">
<h2 class="hasAnchor">
<a href="#download" class="anchor"></a>Download</h2>
<p>NHDPlusHR support in nhdplusTools begins with the function <code><a href="../reference/download_nhdplushr.html">download_nhdplushr()</a></code>. The NHDPlusHR can be downloaded in <a href="https://www.usgs.gov/core-science-systems/ngp/national-hydrography/access-national-hydrography-products">four digit hydrologic unit code subsets here.</a> <code><a href="../reference/download_nhdplushr.html">download_nhdplushr()</a></code> facilitates downloading these subsets for as few or as many as you need. It takes a directory you want to save your output into and a vector of four digit (HU04) or two digit (HU02) hydrologic units. There is also an option to just return the URLs of the data that would be downloaded for you to use in some other process. Since the TL;DR; above already downloaded some data. The code below shows how to just get the URLs for a whole HU02 and what the output looks like on disk.</p>
<p><em>Note: Data for each HU02 are put in their own output folder.</em></p>
<div class="sourceCode" id="cb78"><html><body><pre class="r">(<span class="no">hr_urls</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/download_nhdplushr.html">download_nhdplushr</a></span>(<span class="no">work_dir</span>, <span class="st">"06"</span>, <span class="kw">download_files</span> <span class="kw">=</span> <span class="fl">FALSE</span>))</pre></body></html></div>
<pre><code>#&gt; [1] "https://prd-tnm.s3.amazonaws.com/StagedProducts/Hydrography/NHDPlusHR/Beta/GDB/NHDPLUS_H_0601_HU4_GDB.zip"
#&gt; [2] "https://prd-tnm.s3.amazonaws.com/StagedProducts/Hydrography/NHDPlusHR/Beta/GDB/NHDPLUS_H_0602_HU4_GDB.zip"
#&gt; [3] "https://prd-tnm.s3.amazonaws.com/StagedProducts/Hydrography/NHDPlusHR/Beta/GDB/NHDPLUS_H_0603_HU4_GDB.zip"
#&gt; [4] "https://prd-tnm.s3.amazonaws.com/StagedProducts/Hydrography/NHDPlusHR/Beta/GDB/NHDPLUS_H_0604_HU4_GDB.zip"</code></pre>
<div class="sourceCode" id="cb80"><html><body><pre class="r"><span class="co"># already downloaded:</span>
<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="no">hr_data_dir</span>)</pre></body></html></div>
<pre><code>#&gt; [1] "NHDPLUS_H_0709_HU4_GDB.gdb" "NHDPLUS_H_0709_HU4_GDB.jpg"
#&gt; [3] "NHDPLUS_H_0709_HU4_GDB.xml"</code></pre>
</div>
<div id="basic-functionality" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-functionality" class="anchor"></a>Basic functionality</h2>
<p>The second part of nhdplusTools support for NHDPlusHR is a bit more involved. The entry point is a function called <code><a href="../reference/get_nhdplushr.html">get_nhdplushr()</a></code>. At it’s core, it will take a collection of NHDPlusHR subsets, open them up one by one and build a single output table for later use. It also 1. joins flowline attributes to the flowline geometry, 1. can return one or more selected layers, 1. can save the result to a standalone geopackage for later use, and 1. can make some attributes of a subset look like they are part of a standalone network rather than having references to downstream data that aren’t in the subset.</p>
<p>Using the data we downloaded in the TL;DR; intro, the code below demonstrates a few behaviors of <code><a href="../reference/get_nhdplushr.html">get_nhdplushr()</a></code></p>
<p>First, if we just give it a directory containing HR data, it will give us back a list with flowlines and catchments as sf data.frames.</p>
<div class="sourceCode" id="cb82"><html><body><pre class="r"><span class="no">hr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_nhdplushr.html">get_nhdplushr</a></span>(<span class="no">hr_data_dir</span>)
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">hr</span>, <span class="no">class</span>)</pre></body></html></div>
<pre><code>#&gt;      NHDFlowline  NHDPlusCatchment
#&gt; [1,] "sf"         "sf"            
#&gt; [2,] "tbl_df"     "tbl_df"        
#&gt; [3,] "tbl"        "tbl"           
#&gt; [4,] "data.frame" "data.frame"</code></pre>
<div class="sourceCode" id="cb84"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="no">hr</span>$<span class="no">NHDFlowline</span>), <span class="kw">lwd</span> <span class="kw">=</span> (<span class="no">hr</span>$<span class="no">NHDFlowline</span>$<span class="no">StreamOrde</span> / <span class="fl">6</span>))</pre></body></html></div>
<p><img src="nhdplushr_files/figure-html/get_nhdplushr-1.png" width="816"></p>
<p>If we want more data, we can get any of the layer options listed in the <code><a href="../reference/get_nhdplushr.html">get_nhdplushr()</a></code> documentation.</p>
<div class="sourceCode" id="cb85"><html><body><pre class="r"><span class="no">hr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_nhdplushr.html">get_nhdplushr</a></span>(<span class="no">hr_data_dir</span>, <span class="kw">layers</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"NHDFlowline"</span>, <span class="st">"NHDWaterbody"</span>, <span class="st">"NHDArea"</span>))</pre></body></html></div>
<pre><code>#&gt; Warning in CPL_read_ogr(dsn, layer, query, as.character(options), quiet, :
#&gt; GDAL Message 1: organizePolygons() received a polygon with more than 100 parts.
#&gt; The processing may be really slow. You can skip the processing by setting
#&gt; METHOD=SKIP, or only make it analyze counter-clock wise parts by setting
#&gt; METHOD=ONLY_CCW if you can assume that the outline of holes is counter-clock
#&gt; wise defined</code></pre>
<div class="sourceCode" id="cb87"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">hr</span>, <span class="no">class</span>)</pre></body></html></div>
<pre><code>#&gt;      NHDFlowline  NHDWaterbody NHDArea     
#&gt; [1,] "sf"         "sf"         "sf"        
#&gt; [2,] "tbl_df"     "tbl_df"     "tbl_df"    
#&gt; [3,] "tbl"        "tbl"        "tbl"       
#&gt; [4,] "data.frame" "data.frame" "data.frame"</code></pre>
<div class="sourceCode" id="cb89"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">hr</span>, <span class="no">nrow</span>)</pre></body></html></div>
<pre><code>#&gt;  NHDFlowline NHDWaterbody      NHDArea 
#&gt;        34532        11444          499</code></pre>
<div class="sourceCode" id="cb91"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="no">hr</span>$<span class="no">NHDFlowline</span>), <span class="kw">lwd</span> <span class="kw">=</span> (<span class="no">hr</span>$<span class="no">NHDFlowline</span>$<span class="no">StreamOrde</span> / <span class="fl">6</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="st">"blue"</span>)

<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="no">hr</span>$<span class="no">NHDWaterbody</span>), <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="no">hr</span>$<span class="no">NHDArea</span>)),
     <span class="kw">col</span> <span class="kw">=</span> <span class="st">"cyan"</span>, <span class="kw">border</span> <span class="kw">=</span> <span class="st">"cyan"</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">0.25</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="nhdplushr_files/figure-html/get_nhdplushr2-1.png" width="816"></p>
<p>Since this function can work over large ammounts of data and we don’t want to keep running it again and again, there is an option to save the results to a standalone database for later use.</p>
<div class="sourceCode" id="cb92"><html><body><pre class="r"><span class="no">demo_gpkg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">work_dir</span>, <span class="st">"demo.gpkg"</span>)
<span class="no">hr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_nhdplushr.html">get_nhdplushr</a></span>(<span class="no">hr_data_dir</span>, <span class="kw">out_gpkg</span> <span class="kw">=</span> <span class="no">demo_gpkg</span>)
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_layers.html">st_layers</a></span>(<span class="no">demo_gpkg</span>)</pre></body></html></div>
<pre><code>#&gt; Driver: GPKG 
#&gt; Available layers:
#&gt;         layer_name     geometry_type features fields
#&gt; 1      NHDFlowline Multi Line String    34532     57
#&gt; 2 NHDPlusCatchment     Multi Polygon    42300      7</code></pre>
</div>
<div id="hr-modification-and-filtering" class="section level2">
<h2 class="hasAnchor">
<a href="#hr-modification-and-filtering" class="anchor"></a>HR modification and filtering</h2>
<p>Since NHDPlusHR data can be very large, <code><a href="../reference/get_nhdplushr.html">get_nhdplushr()</a></code> offers the ability to subset the data using a few filter options. Most of the filters are described in the manual page of the <code><a href="../reference/get_hr_data.html">get_hr_data()</a></code> utility function. 1. <code>min_size_sqkm</code> will remove flowlines under a certain size threshold. 1. <code>sim</code> will simplify all geometry to a given tolerance using <code><a href="https://rdrr.io/pkg/sf/man/geos_unary.html">sf::st_simplify()</a></code>. 1. <code>proj</code> will project the output into the desired projection. 1. <code>keep_cols</code> is used to specify which attributes are desired in the output. 1. <code>rename</code> controls whether output is automatically renamed to be compatible with <code>nhdplusTools</code> functions.</p>
<p><em>Note: These options only operate on the flowline network.</em></p>
<div class="sourceCode" id="cb94"><html><body><pre class="r"><span class="no">demo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_nhdplushr.html">get_nhdplushr</a></span>(<span class="no">hr_data_dir</span>, <span class="kw">layers</span> <span class="kw">=</span> <span class="st">"NHDFlowline"</span>,
                               <span class="kw">min_size_sqkm</span> <span class="kw">=</span> <span class="fl">50</span>)
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="no">demo</span>$<span class="no">NHDFlowline</span>),
     <span class="kw">lwd</span> <span class="kw">=</span> <span class="no">demo</span>$<span class="no">NHDFlowline</span>$<span class="no">StreamOrde</span>/<span class="fl">4</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"blue"</span>)</pre></body></html></div>
<p><img src="nhdplushr_files/figure-html/get_nhdplushr4-1.png" width="816"></p>
<div class="sourceCode" id="cb95"><html><body><pre class="r"><span class="no">demo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_nhdplushr.html">get_nhdplushr</a></span>(<span class="no">hr_data_dir</span>, <span class="kw">layers</span> <span class="kw">=</span> <span class="st">"NHDFlowline"</span>,
                      <span class="kw">min_size_sqkm</span> <span class="kw">=</span> <span class="fl">100</span>,
                      <span class="kw">proj</span> <span class="kw">=</span> <span class="st">"+init=epsg:5070"</span>, <span class="kw">simp</span> <span class="kw">=</span> <span class="fl">200</span>,
                      <span class="kw">keep_cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"COMID"</span>, <span class="st">"StreamOrde"</span>))
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">demo</span>$<span class="no">NHDFlowline</span>)</pre></body></html></div>
<pre><code>#&gt; [1] "COMID"      "StreamOrde" "Shape"</code></pre>
<div class="sourceCode" id="cb97"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="no">demo</span>$<span class="no">NHDFlowline</span>),
     <span class="kw">lwd</span> <span class="kw">=</span> <span class="no">demo</span>$<span class="no">NHDFlowline</span>$<span class="no">StreamOrde</span>/<span class="fl">4</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"blue"</span>)</pre></body></html></div>
<p><img src="nhdplushr_files/figure-html/get_nhdplushr5-1.png" width="816"></p>
</div>
<div id="make-standalone-basins" class="section level2">
<h2 class="hasAnchor">
<a href="#make-standalone-basins" class="anchor"></a>Make Standalone Basins</h2>
<p>The NHDPlus data model has some shared identifiers that can span very large distances. For example, the “Level Path Identifier” identifies an entire river from headwater to outlet using the “hydrologic sequence identifier” of the outlet. Similarly, the “Terminal Path Identifier” identifies an entire basin using the hydrologic sequence identifier of the terminal flowline (to the ocean or an inland sink). When creating subsets of NHDPlus data, many times, these attributes can identify flowlines that are not included in the subset. For most applications, this is not a problem, but in some cases, it is advantageous to adjust identifiers such that the subset appears to be a complete drainage basin with a true terminal outlet. <code><a href="../reference/make_standalone.html">make_standalone()</a></code> accomplishes this task.</p>
<p>On a one by one basis, this may seam insignificant, but for workflows that need to work with arbitrary subsets and start from basin outlets, this functionality is useful. It has little impact on the data and is applied by default.</p>
<p>The example below shows how the outlet is modified. As described in the documentation os <code><a href="../reference/make_standalone.html">make_standalone()</a></code> all related attribues upstream are also fixed such that the network is intact for further use.</p>
<div class="sourceCode" id="cb98"><html><body><pre class="r"><span class="no">demo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_nhdplushr.html">get_nhdplushr</a></span>(<span class="no">hr_data_dir</span>, <span class="kw">layers</span> <span class="kw">=</span> <span class="st">"NHDFlowline"</span>,
                    <span class="kw">min_size_sqkm</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">check_terminals</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co"># Create a standalone basin with the results for comparison.</span>
<span class="no">standalone_demo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/make_standalone.html">make_standalone</a></span>(<span class="no">demo</span>$<span class="no">NHDFlowline</span>)

<span class="no">demo_outlet</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">demo</span>$<span class="no">NHDFlowline</span>, <span class="no">TotDASqKM</span> <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">TotDASqKM</span>))

<span class="no">standalone_demo_outlet</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">standalone_demo</span>, <span class="no">TotDASqKM</span> <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">TotDASqKM</span>))

<span class="no">broken_outlet</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_drop_geometry</a></span>(<span class="no">demo_outlet</span>),
                               <span class="no">Hydroseq</span>, <span class="no">TerminalPa</span>, <span class="no">TerminalFl</span>, <span class="no">LevelPathI</span>)
<span class="no">fixed_outlet</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_drop_geometry</a></span>(<span class="no">standalone_demo_outlet</span>),
                              <span class="no">Hydroseq</span>, <span class="no">TerminalPa</span>, <span class="no">TerminalFl</span>, <span class="no">LevelPathI</span>)

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">broken_outlet</span>))</pre></body></html></div>
<pre><code>#&gt;         Hydroseq     TerminalPa TerminalFl     LevelPathI
#&gt; 1 22001000000414 22000100000212          0 22000300045683</code></pre>
<div class="sourceCode" id="cb100"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">fixed_outlet</span>))</pre></body></html></div>
<pre><code>#&gt;         Hydroseq     TerminalPa TerminalFl     LevelPathI
#&gt; 1 22001000000414 22001000000414          1 22001000000414</code></pre>
<div class="sourceCode" id="cb102"><html><body><pre class="r">(<span class="no">broken</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">demo</span>$<span class="no">NHDFlowline</span>, <span class="no">TerminalPa</span> <span class="kw">==</span> <span class="no">demo_outlet</span>$<span class="no">Hydroseq</span>))</pre></body></html></div>
<pre><code>#&gt; Simple feature collection with 0 features and 57 fields
#&gt; bbox:           xmin: NA ymin: NA xmax: NA ymax: NA
#&gt; geographic CRS: NAD83
#&gt; # A tibble: 0 x 58
#&gt; # … with 58 variables: Permanent_Identifier &lt;chr&gt;, FDate &lt;dttm&gt;,
#&gt; #   Resolution &lt;int&gt;, GNIS_ID &lt;chr&gt;, GNIS_Name &lt;chr&gt;, LENGTHKM &lt;dbl&gt;,
#&gt; #   REACHCODE &lt;chr&gt;, FlowDir &lt;int&gt;, WBArea_Permanent_Identifier &lt;chr&gt;,
#&gt; #   FTYPE &lt;int&gt;, FCode &lt;int&gt;, MainPath &lt;int&gt;, InNetwork &lt;int&gt;,
#&gt; #   VisibilityFilter &lt;int&gt;, Shape_Length &lt;dbl&gt;, COMID &lt;dbl&gt;, VPUID &lt;chr&gt;,
#&gt; #   Enabled &lt;int&gt;, Shape &lt;GEOMETRY [°]&gt;, StreamLeve &lt;int&gt;, StreamOrde &lt;int&gt;,
#&gt; #   StreamCalc &lt;int&gt;, FromNode &lt;dbl&gt;, ToNode &lt;dbl&gt;, Hydroseq &lt;dbl&gt;,
#&gt; #   LevelPathI &lt;dbl&gt;, Pathlength &lt;dbl&gt;, TerminalPa &lt;dbl&gt;, ArbolateSu &lt;dbl&gt;,
#&gt; #   Divergence &lt;int&gt;, StartFlag &lt;int&gt;, TerminalFl &lt;int&gt;, UpLevelPat &lt;dbl&gt;,
#&gt; #   UpHydroseq &lt;dbl&gt;, DnLevel &lt;int&gt;, DnLevelPat &lt;dbl&gt;, DnHydroseq &lt;dbl&gt;,
#&gt; #   DnMinorHyd &lt;dbl&gt;, DnDrainCou &lt;int&gt;, FromMeas &lt;dbl&gt;, ToMeas &lt;dbl&gt;,
#&gt; #   RtnDiv &lt;int&gt;, Thinner &lt;int&gt;, VPUIn &lt;int&gt;, VPUOut &lt;int&gt;, AreaSqKM &lt;dbl&gt;,
#&gt; #   TotDASqKM &lt;dbl&gt;, DivDASqKm &lt;dbl&gt;, MaxElevRaw &lt;dbl&gt;, MinElevRaw &lt;dbl&gt;,
#&gt; #   MaxElevSmo &lt;dbl&gt;, MinElevSmo &lt;dbl&gt;, Slope &lt;dbl&gt;, SlopeLenKm &lt;dbl&gt;,
#&gt; #   ElevFixed &lt;int&gt;, HWType &lt;int&gt;, HWNodeSqKm &lt;dbl&gt;, StatusFlag &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb104"><html><body><pre class="r">(<span class="no">standalone</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">standalone_demo</span>, <span class="no">TerminalPa</span> <span class="kw">==</span> <span class="no">standalone_demo_outlet</span>$<span class="no">Hydroseq</span>))</pre></body></html></div>
<pre><code>#&gt; Simple feature collection with 5358 features and 57 fields
#&gt; geometry type:  MULTILINESTRING
#&gt; dimension:      XY
#&gt; bbox:           xmin: -90.68076 ymin: 41.27482 xmax: -88.1999 ymax: 43.74949
#&gt; geographic CRS: NAD83
#&gt; # A tibble: 5,358 x 58
#&gt;    Permanent_Ident… FDate               Resolution GNIS_ID GNIS_Name LENGTHKM
#&gt;  * &lt;chr&gt;            &lt;dttm&gt;                   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt;
#&gt;  1 156038282        2012-03-19 06:32:25          2 004155… Pecatoni…    1.34 
#&gt;  2 155714162        2014-10-29 00:00:00          2 004248… Fairfiel…    0.417
#&gt;  3 156035374        2012-03-19 06:35:08          2 015619… Gordon C…    0.39 
#&gt;  4 145600320        2012-03-19 06:34:47          2 004168… Rock Cre…    0.352
#&gt;  5 155712981        2012-03-19 07:05:43          2 &lt;NA&gt;    &lt;NA&gt;         0.034
#&gt;  6 137417698        2012-03-18 18:07:30          2 015750… Sugar Ri…    0.798
#&gt;  7 156037500        2012-03-19 06:33:10          2 &lt;NA&gt;    &lt;NA&gt;         0.009
#&gt;  8 145599800        2012-03-19 06:34:47          2 004145… North Fo…    0.665
#&gt;  9 143246785        2012-03-18 17:56:42          2 004168… Rock Riv…    0.165
#&gt; 10 155712415        2012-03-19 07:05:51          2 004241… Willow C…    2.11 
#&gt; # … with 5,348 more rows, and 52 more variables: REACHCODE &lt;chr&gt;,
#&gt; #   FlowDir &lt;int&gt;, WBArea_Permanent_Identifier &lt;chr&gt;, FTYPE &lt;int&gt;, FCode &lt;int&gt;,
#&gt; #   MainPath &lt;int&gt;, InNetwork &lt;int&gt;, VisibilityFilter &lt;int&gt;,
#&gt; #   Shape_Length &lt;dbl&gt;, COMID &lt;dbl&gt;, VPUID &lt;chr&gt;, Enabled &lt;int&gt;,
#&gt; #   Shape &lt;MULTILINESTRING [°]&gt;, StreamLeve &lt;int&gt;, StreamOrde &lt;int&gt;,
#&gt; #   StreamCalc &lt;int&gt;, FromNode &lt;dbl&gt;, ToNode &lt;dbl&gt;, Hydroseq &lt;dbl&gt;,
#&gt; #   LevelPathI &lt;dbl&gt;, Pathlength &lt;dbl&gt;, TerminalPa &lt;dbl&gt;, ArbolateSu &lt;dbl&gt;,
#&gt; #   Divergence &lt;int&gt;, StartFlag &lt;int&gt;, TerminalFl &lt;dbl&gt;, UpLevelPat &lt;dbl&gt;,
#&gt; #   UpHydroseq &lt;dbl&gt;, DnLevel &lt;dbl&gt;, DnLevelPat &lt;dbl&gt;, DnHydroseq &lt;dbl&gt;,
#&gt; #   DnMinorHyd &lt;dbl&gt;, DnDrainCou &lt;int&gt;, FromMeas &lt;dbl&gt;, ToMeas &lt;dbl&gt;,
#&gt; #   RtnDiv &lt;int&gt;, Thinner &lt;int&gt;, VPUIn &lt;int&gt;, VPUOut &lt;int&gt;, AreaSqKM &lt;dbl&gt;,
#&gt; #   TotDASqKM &lt;dbl&gt;, DivDASqKm &lt;dbl&gt;, MaxElevRaw &lt;dbl&gt;, MinElevRaw &lt;dbl&gt;,
#&gt; #   MaxElevSmo &lt;dbl&gt;, MinElevSmo &lt;dbl&gt;, Slope &lt;dbl&gt;, SlopeLenKm &lt;dbl&gt;,
#&gt; #   ElevFixed &lt;int&gt;, HWType &lt;int&gt;, HWNodeSqKm &lt;dbl&gt;, StatusFlag &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb106"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="no">standalone</span>))</pre></body></html></div>
<p><img src="nhdplushr_files/figure-html/make_standalone-1.png" width="816"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by David Blodgett.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
